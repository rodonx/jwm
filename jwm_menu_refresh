#!/bin/ash 
# This file generates the jwm menu based on the XDG menu structure
# It replaces the PUPPYMENU lines with the submenu generated by
# the jwm XDG menu generator
#2012-07-24 RoDoN for PuppyRus Richy
#130918 sfs
#131215 sfs
#2016-02-22 RoDoN for JWM 2.3.4
DIR=`pwd`
HOME1="`sfsusr`"
[ "$HOME1" = "root" ] && HOME1=/$HOME1 || HOME1=/home/$HOME1
echo Generating $HOME1/.jwmrc...

cd $HOME1
mv -f .jwmrc .jwmrc-previous

cfg="$HOME1/.jwmrc"

BAC(){
echo '<?xml version="1.0"?>
<JWM>
 <RootMenu label="Меню" labeled="false" height="32" onroot="3">
  <Program label="Центр управления" icon="x48">exec menu-cc</Program>
  <Separator/>
  <Program label="Файловый менеджер" icon="folder48">exec defaultfilemanager ~</Program>
  <Program label="Интернет браузер" icon="www48">exec defaultbrowser</Program>
  <Program label="Терминал" icon="console48">exec defaultterminal</Program>
  <Separator/>
  <Dynamic label="Приложения" icon="/usr/share/xpupsay/cow_small.png">exec: jwm_xdgmenu.sh</Dynamic>
  <Separator/>
  <Dynamic label="Приложения jwmtst" icon="/usr/share/xpupsay/cow_small.png">exec: jwmtst</Dynamic>
  <Separator/>  <Program label="Справка" icon="help48">exec puppyhelp</Program>
  <Program label="Выключение" icon="shutdown48">exec sfs-shutdown</Program>
 </RootMenu>

	<Group>
		<Class>Gaim</Class>
		<Option>sticky</Option>
	</Group>

	<Group>
		<Name>xmessage</Name>
		<!-- <Option>icon:info16.xpm</Option> -->
		<Option>notitle</Option>
		<Option>nolist</Option>
	</Group>

	<Group>
		<Class>gtkdialog-splash</Class>
		<Option>nolist</Option>
	<!--	<Option>layer:9</Option> -->
		<Option>nofocus</Option>
	</Group>

	<!-- Additional tray attributes: autohide, width, border, layer, layout -->
	<!-- Tray definition moved to separate file: .jwmrc-tray -->
	<Include>$HOME/.jwmrc-tray</Include>

	<!-- <Icons> -->
	<!-- <IconPath>$HOME/.icons</IconPath> -->
	<IconPath>/usr/share/icons</IconPath>
	<IconPath>/usr/share/pixmaps</IconPath>
	<IconPath>/usr/local/share/pixmaps</IconPath>
	<IconPath>/usr/share/icons/hicolor/48x48/apps</IconPath>
	<IconPath>/usr/share/icons/hicolor/32x32/apps</IconPath>
	<IconPath>/usr/share/icons/hicolor/24x24/apps</IconPath>
	<IconPath>/usr/share/icons/hicolor/22x22/stock/image</IconPath>
	<!-- </Icons> -->

	<StartupCommand>exec $HOME/.jwm/startup</StartupCommand>

 <!-- <Include>$HOME/.jwm/themes/jwm-default</Include> -->
 <Include>$HOME/.jwm/jwmrc-bar</Include>
 <Include>$HOME/.jwm/jwmrc-menu-0</Include>
 <Include>$HOME/.jwm/jwmrc-menu-2</Include>
 <Include>$HOME/.jwm/jwmrc-theme</Include>
 <Include>$HOME/.jwm/jwmrc-personal</Include>
</JWM> ' >>$cfg
}
BAC

if [ "`pidof jwm`" != "" ];then
jwm-rst && echo "jwm -reloaded..."
fi

cd "$DIR"
